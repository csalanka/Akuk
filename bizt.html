<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akkumul√°tor Menedzser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #ddd;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        .tab-button.active {
            background: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }
        th {
            background: #f8f9fa;
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: black;
        }
        .search-box {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }
        .form-control {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            max-width: 500px;
            width: 90%;
        }
        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            color: white;
        }
        .badge-excellent { background: #28a745; }
        .badge-good { background: #17a2b8; }
        .badge-average { background: #ffc107; }
        .badge-poor { background: #dc3545; }
        .badge-replace { background: #6c757d; }
        @media (max-width: 600px) {
            .tab-buttons, .controls {
                flex-direction: column;
            }
            .btn, .search-box, .form-control {
                width: 100%;
            }
            th, td {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Akkumul√°tor Menedzser</h1>
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('devices')" id="devicesTab">üì± Eszk√∂z√∂k</button>
            <button class="tab-button" onclick="showTab('batteries')" id="batteriesTab">üîã Akkumul√°torok</button>
            <button class="tab-button" onclick="showTab('assignments')" id="assignmentsTab">üîÑ V√°ndorl√°s</button>
        </div>
        <div id="devicesContent" class="tab-content active">
            <div class="controls">
                <input type="file" id="csvInput" accept=".csv" style="margin-right: 10px;" />
                <button class="btn btn-primary" onclick="loadCSV()">üìÅ Eszk√∂z CSV</button>
                <button class="btn btn-success" onclick="addDevice()">‚ûï √öj Eszk√∂z</button>
                <button class="btn btn-warning" onclick="exportCSV()">üíæ Eszk√∂z Export</button>
                <button class="btn btn-warning" onclick="deleteSampleData()">üóëÔ∏è Mintaadatok T√∂rl√©se</button>
                <input type="text" id="searchInput" class="search-box" placeholder="üîç Keres√©s n√©v vagy hely szerint..." />
                <select id="typeFilter" class="form-control" style="width: auto; margin-left: 10px;" onchange="renderTable()">
                    <option value="">üîã Minden t√≠pus</option>
                    <option value="">Ismeretlen</option>
                    <option value="Li-ion_18V">Li-ion 18V</option>
                    <option value="Li-ion_12V">Li-ion 12V</option>
                    <option value="NiMH_AA">NiMH AA</option>
                    <option value="NiMH_AAA">NiMH AAA</option>
                    <option value="Li-ion_18650">Li-ion 18650</option>
                </select>
                <select id="chargerFilter" class="form-control" style="width: auto; margin-left: 10px;" onchange="renderTable()">
                    <option value="">üîå Minden t√∂lt≈ë</option>
                    <option value="Gyari_tolto">Gy√°ri t√∂lt≈ë</option>
                    <option value="Dokkolo_tolto">Dokkol√≥ t√∂lt≈ë</option>
                    <option value="Univerzalis_tolto">Univerz√°lis t√∂lt≈ë</option>
                </select>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>N√©v</th>
                            <th>Hely</th>
                            <th>T√≠pus</th>
                            <th>Db</th>
                            <th>T√∂lt≈ë</th>
                            <th>Gyakoris√°g</th>
                            <th>Utols√≥ t√∂lt√©s</th>
                            <th>Aktu√°lis akku</th>
                            <th>M≈±veletek</th>
                        </tr>
                    </thead>
                    <tbody id="deviceTableBody"></tbody>
                </table>
            </div>
        </div>
        <div id="batteriesContent" class="tab-content">
            <div class="controls">
                <input type="file" id="batteryCSVInput" accept=".csv" style="margin-right: 10px;" />
                <button class="btn btn-primary" onclick="loadBatteryCSV()">üìÅ Akku CSV</button>
                <button class="btn btn-success" onclick="addBattery()">‚ûï √öj Akkumul√°tor</button>
                <button class="btn btn-warning" onclick="exportBatteryCSV()">üíæ Akku Export</button>
                <input type="text" id="batterySearchInput" class="search-box" placeholder="üîç Keres√©s akku ID vagy t√≠pus szerint..." />
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Akku ID</th>
                            <th>T√≠pus</th>
                            <th>Bels≈ë ellen√°ll√°s (mŒ©)</th>
                            <th>Kapacit√°s (mAh)</th>
                            <th>Felhaszn√°l√°si sz√°m</th>
                            <th>Min≈ës√©g</th>
                            <th>Utols√≥ t√∂lt√©s</th>
                            <th>M≈±veletek</th>
                        </tr>
                    </thead>
                    <tbody id="batteryTableBody"></tbody>
                </table>
            </div>
        </div>
        <div id="assignmentsContent" class="tab-content">
            <div class="controls">
                <input type="file" id="assignmentCSVInput" accept=".csv" style="margin-right: 10px;" />
                <button class="btn btn-primary" onclick="loadAssignmentCSV()">üìÅ V√°ndorl√°s CSV</button>
                <button class="btn btn-success" onclick="addAssignment()">‚ûï √öj √ñsszerendel√©s</button>
                <button class="btn btn-warning" onclick="exportAssignmentCSV()">üíæ V√°ndorl√°s Export</button>
                <input type="text" id="assignmentSearchInput" class="search-box" placeholder="üîç Keres√©s akku ID vagy eszk√∂z ID szerint..." />
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>√ñsszerendel√©s ID</th>
                            <th>Akku ID</th>
                            <th>Eszk√∂z ID</th>
                            <th>D√°tum</th>
                            <th>√Ållapot</th>
                            <th>M≈±veletek</th>
                        </tr>
                    </thead>
                    <tbody id="assignmentTableBody"></tbody>
                </table>
            </div>
        </div>
        <div id="deviceModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle">√öj Eszk√∂z</h2>
                <form id="deviceForm">
                    <div class="form-group">
                        <label>Eszk√∂z ID:</label>
                        <input type="text" id="deviceId" class="form-control" required readonly>
                    </div>
                    <div class="form-group">
                        <label>N√©v:</label>
                        <input type="text" id="deviceName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Hely:</label>
                        <input type="text" id="deviceLocation" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Akkumul√°tor T√≠pus:</label>
                        <select id="batteryType" class="form-control">
                            <option value="">Ismeretlen</option>
                            <option value="Li-ion_18V">Li-ion 18V</option>
                            <option value="Li-ion_12V">Li-ion 12V</option>
                            <option value="NiMH_AA">NiMH AA</option>
                            <option value="NiMH_AAA">NiMH AAA</option>
                            <option value="Li-ion_18650">Li-ion 18650</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Darabsz√°m:</label>
                        <input type="number" id="batteryCount" class="form-control" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label>T√∂lt≈ë T√≠pus:</label>
                        <select id="chargerType" class="form-control" required>
                            <option value="Gyari_tolto">Gy√°ri t√∂lt≈ë</option>
                            <option value="Dokkolo_tolto">Dokkol√≥ t√∂lt≈ë</option>
                            <option value="Univerzalis_tolto">Univerz√°lis t√∂lt≈ë</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Haszn√°lati Gyakoris√°g:</label>
                        <select id="usageFrequency" class="form-control">
                            <option value="">Nincs megadva</option>
                            <option value="Napi">Napi</option>
                            <option value="Heti">Heti</option>
                            <option value="Havi">Havi</option>
                            <option value="Veszhelyzeti">V√©szhelyzeti</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Utols√≥ T√∂lt√©s:</label>
                        <input type="date" id="lastCharge" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Megjegyz√©sek:</label>
                        <textarea id="notes" class="form-control"></textarea>
                    </div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeModal()">M√©gse</button>
                        <button type="submit" class="btn btn-success" style="margin-left: 10px;">üíæ Ment√©s</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="batteryModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeBatteryModal()">&times;</span>
                <h2 id="batteryModalTitle">√öj Akkumul√°tor</h2>
                <form id="batteryForm">
                    <div class="form-group">
                        <label>Akku ID:</label>
                        <input type="text" id="batteryId" class="form-control" required readonly>
                    </div>
                    <div class="form-group">
                        <label>T√≠pus:</label>
                        <select id="batteryTypeSelect" class="form-control" required>
                            <option value="Li-ion_18V">Li-ion 18V</option>
                            <option value="Li-ion_12V">Li-ion 12V</option>
                            <option value="NiMH_AA">NiMH AA</option>
                            <option value="NiMH_AAA">NiMH AAA</option>
                            <option value="Li-ion_18650">Li-ion 18650</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bels≈ë ellen√°ll√°s (mŒ©):</label>
                        <input type="number" id="internalResistance" class="form-control" step="0.1" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Kapacit√°s (mAh):</label>
                        <input type="number" id="capacity" class="form-control" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Felhaszn√°l√°si sz√°m:</label>
                        <input type="number" id="usageCount" class="form-control" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Min≈ës√©g:</label>
                        <select id="quality" class="form-control" required>
                            <option value="Kiv√°l√≥">Kiv√°l√≥</option>
                            <option value="J√≥">J√≥</option>
                            <option value="K√∂zepes">K√∂zepes</option>
                            <option value="Gyenge">Gyenge</option>
                            <option value="Cser√©lend≈ë">Cser√©lend≈ë</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Utols√≥ t√∂lt√©s:</label>
                        <input type="date" id="batteryLastCharge" class="form-control" required>
                    </div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeBatteryModal()">M√©gse</button>
                        <button type="submit" class="btn btn-success" style="margin-left: 10px;">üíæ Ment√©s</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="batteryAssignModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeBatteryAssignModal()">&times;</span>
                <h2 id="batteryAssignModalTitle">Akkumul√°tor Bet√°raz√°sa</h2>
                <form id="batteryAssignForm">
                    <div class="form-group">
                        <label>Eszk√∂z:</label>
                        <input type="text" id="assignDeviceId" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>Akkumul√°tor:</label>
                        <select id="assignBatteryId" class="form-control" required>
                            <option value="">V√°lassz akkumul√°tort...</option>
                        </select>
                        <p id="recommendedBattery" style="margin-top: 10px; font-style: italic;"></p>
                    </div>
                    <div class="form-group">
                        <label>D√°tum:</label>
                        <input type="date" id="assignDate" class="form-control" required>
                    </div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button type="button" class="btn btn-success" onclick="acceptRecommended()">‚úÖ Aj√°nlott elfogad√°sa</button>
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeBatteryAssignModal()">M√©gse</button>
                        <button type="submit" class="btn btn-success" style="margin-left: 10px;">üíæ Ment√©s</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="assignmentModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeAssignmentModal()">&times;</span>
                <h2 id="assignmentModalTitle">√öj √ñsszerendel√©s</h2>
                <form id="assignmentForm">
                    <div class="form-group">
                        <label>√ñsszerendel√©s ID:</label>
                        <input type="text" id="assignmentId" class="form-control" required readonly>
                    </div>
                    <div class="form-group">
                        <label>Akkumul√°tor:</label>
                        <select id="assignmentBatteryId" class="form-control" required>
                            <option value="">V√°lassz akkumul√°tort...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Eszk√∂z:</label>
                        <select id="assignmentDeviceId" class="form-control">
                            <option value="">Tartal√©k (nincs eszk√∂z)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>D√°tum:</label>
                        <input type="date" id="assignmentDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>√Ållapot:</label>
                        <select id="assignmentStatus" class="form-control" required>
                            <option value="betarazva">Bet√°razva</option>
                            <option value="tartalek">Tartal√©k</option>
                        </select>
                    </div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeAssignmentModal()">M√©gse</button>
                        <button type="submit" class="btn btn-success" style="margin-left: 10px;">üíæ Ment√©s</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let devices = [
            { id: "ESZ001", name: "Furogep_Bosch", location: "Muhely", batteryType: "Li-ion_18V", batteryCount: 1, chargerType: "Gyari_tolto", usageFrequency: "Heti", lastCharge: "2025-01-20", notes: "Piros_szinu" },
            { id: "ESZ002", name: "LED_Lampa", location: "Haloszoba", batteryType: "NiMH_AA", batteryCount: 4, chargerType: "Dokkolo_tolto", usageFrequency: "Veszhelyzeti", lastCharge: "2025-01-15", notes: "Ejjeliszekrenyen" },
            { id: "ESZ003", name: "Taviranyito", location: "Nappali", batteryType: "NiMH_AA", batteryCount: 2, chargerType: "Univerzalis_tolto", usageFrequency: "Napi", lastCharge: "2025-01-22", notes: "Sony_taviranyito" }
        ];
        let batteries = [
            { id: "AK001", type: "Li-ion_18V", internalResistance: 15.2, capacity: 5000, usageCount: 45, lastCharge: "2025-01-20", quality: "Kiv√°l√≥" },
            { id: "AK002", type: "Li-ion_18V", internalResistance: 28.7, capacity: 4200, usageCount: 128, lastCharge: "2025-01-18", quality: "J√≥" },
            { id: "AK003", type: "NiMH_AA", internalResistance: 85.1, capacity: 2500, usageCount: 67, lastCharge: "2025-01-22", quality: "K√∂zepes" }
        ];
        let batteryAssignments = [
            { assignmentId: "ASS001", batteryId: "AK001", deviceId: "ESZ001", assignmentDate: "2025-01-20", status: "betarazva" },
            { assignmentId: "ASS002", batteryId: "AK003", deviceId: "ESZ002", assignmentDate: "2025-01-15", status: "betarazva" },
            { assignmentId: "ASS003", batteryId: "AK002", deviceId: null, assignmentDate: "2025-01-18", status: "tartalek" }
        ];
        let editingIndex = -1;
        let editingBatteryIndex = -1;
        let editingAssignmentIndex = -1;

        function renderTable() {
            const tbody = document.getElementById('deviceTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const chargerFilter = document.getElementById('chargerFilter').value;
            
            let filteredDevices = devices;
            
            if (searchTerm) {
                filteredDevices = filteredDevices.filter(device => 
                    device.name.toLowerCase().includes(searchTerm) ||
                    device.location.toLowerCase().includes(searchTerm)
                );
            }
            
            if (typeFilter) {
                filteredDevices = filteredDevices.filter(device => 
                    device.batteryType === typeFilter || (typeFilter === "" && !device.batteryType)
                );
            }
            
            if (chargerFilter) {
                filteredDevices = filteredDevices.filter(device => 
                    device.chargerType === chargerFilter
                );
            }

            tbody.innerHTML = '';
            filteredDevices.forEach((device, index) => {
                const actualIndex = devices.indexOf(device);
                const currentBattery = batteryAssignments.find(a => a.deviceId === device.id && a.status === 'betarazva');
                const batteryInfo = currentBattery ? `${currentBattery.batteryId} (${batteries.find(b => b.id === currentBattery.batteryId)?.type || 'Ismeretlen'})` : 'Nincs bet√°razva';
                const batteryTypeDisplay = device.batteryType || 'Ismeretlen';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${device.id}</strong></td>
                    <td>${device.name}</td>
                    <td>${device.location}</td>
                    <td><span style="background: #17a2b8; color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px;">${batteryTypeDisplay}</span></td>
                    <td>${device.batteryCount}</td>
                    <td><span style="background: #6c757d; color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px;">${device.chargerType}</span></td>
                    <td>${device.usageFrequency || '-'}</td>
                    <td>${device.lastCharge || 'Nincs adat'}</td>
                    <td>${batteryInfo}</td>
                    <td>
                        <button class="btn btn-success" style="background: #28a745; color: white; padding: 5px 8px; font-size: 12px; margin-right: 3px;" onclick="chargeNow(${actualIndex})" title="T√∂lt√©s most">üîã</button>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px; margin-right: 3px;" onclick="assignBattery(${actualIndex})" title="Akku bet√°raz√°sa" ${device.batteryCount === 0 || !device.batteryType ? 'disabled' : ''}>üîÑ</button>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="editDevice(${actualIndex})">‚úèÔ∏è</button>
                        <button class="btn" style="background: #dc3545; color: white; padding: 5px 10px; font-size: 12px;" onclick="deleteDevice(${actualIndex})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function addDevice() {
            editingIndex = -1;
            document.getElementById('modalTitle').textContent = '√öj Eszk√∂z';
            document.getElementById('deviceForm').reset();
            const maxId = devices.length > 0 ? Math.max(...devices.map(d => parseInt(d.id.replace('ESZ', '')))) : 0;
            document.getElementById('deviceId').value = `ESZ${String(maxId + 1).padStart(3, '0')}`;
            document.getElementById('deviceModal').style.display = 'block';
        }

        function editDevice(index) {
            editingIndex = index;
            const device = devices[index];
            document.getElementById('modalTitle').textContent = 'Eszk√∂z Szerkeszt√©se';
            document.getElementById('deviceId').value = device.id;
            document.getElementById('deviceName').value = device.name;
            document.getElementById('deviceLocation').value = device.location;
            document.getElementById('batteryType').value = device.batteryType || '';
            document.getElementById('batteryCount').value = device.batteryCount;
            document.getElementById('chargerType').value = device.chargerType;
            document.getElementById('usageFrequency').value = device.usageFrequency || '';
            document.getElementById('lastCharge').value = device.lastCharge || '';
            document.getElementById('notes').value = device.notes || '';
            document.getElementById('deviceModal').style.display = 'block';
        }

        function saveDevice() {
            const device = {
                id: document.getElementById('deviceId').value,
                name: document.getElementById('deviceName').value,
                location: document.getElementById('deviceLocation').value,
                batteryType: document.getElementById('batteryType').value || '',
                batteryCount: parseInt(document.getElementById('batteryCount').value),
                chargerType: document.getElementById('chargerType').value,
                usageFrequency: document.getElementById('usageFrequency').value || null,
                lastCharge: document.getElementById('lastCharge').value || null,
                notes: document.getElementById('notes').value
            };

            if (editingIndex === -1) {
                devices.push(device);
            } else {
                devices[editingIndex] = device;
            }

            closeModal();
            renderTable();
            saveAllCSVs();
        }

        function deleteDevice(index) {
            if (confirm('Biztosan t√∂r√∂lni szeretn√©d ezt az eszk√∂zt?')) {
                devices.splice(index, 1);
                renderTable();
                saveAllCSVs();
            }
        }

        function chargeNow(index) {
            const device = devices[index];
            device.lastCharge = new Date().toISOString().split('T')[0];
            const currentBattery = batteryAssignments.find(a => a.deviceId === device.id && a.status === 'betarazva');
            if (currentBattery) {
                const battery = batteries.find(b => b.id === currentBattery.batteryId);
                if (battery) {
                    battery.lastCharge = device.lastCharge;
                    battery.usageCount = (battery.usageCount || 0) + 1;
                }
            }
            renderTable();
            renderBatteryTable();
            saveAllCSVs();
        }

        function closeModal() {
            document.getElementById('deviceModal').style.display = 'none';
        }

        function renderBatteryTable() {
            const tbody = document.getElementById('batteryTableBody');
            const searchTerm = document.getElementById('batterySearchInput').value.toLowerCase();
            
            let filteredBatteries = batteries;
            
            if (searchTerm) {
                filteredBatteries = filteredBatteries.filter(battery => 
                    battery.id.toLowerCase().includes(searchTerm) ||
                    battery.type.toLowerCase().includes(searchTerm)
                );
            }

            tbody.innerHTML = '';
            filteredBatteries.forEach((battery, index) => {
                const actualIndex = batteries.indexOf(battery);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${battery.id}</strong></td>
                    <td>${battery.type}</td>
                    <td>${battery.internalResistance}</td>
                    <td>${battery.capacity}</td>
                    <td>${battery.usageCount}</td>
                    <td><span class="badge badge-${battery.quality.toLowerCase()}">${battery.quality}</span></td>
                    <td>${battery.lastCharge || 'Nincs adat'}</td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="editBattery(${actualIndex})">‚úèÔ∏è</button>
                        <button class="btn" style="background: #dc3545; color: white; padding: 5px 10px; font-size: 12px;" onclick="deleteBattery(${actualIndex})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function addBattery() {
            editingBatteryIndex = -1;
            document.getElementById('batteryModalTitle').textContent = '√öj Akkumul√°tor';
            document.getElementById('batteryForm').reset();
            const maxId = batteries.length > 0 ? Math.max(...batteries.map(b => parseInt(b.id.replace('AK', '')))) : 0;
            document.getElementById('batteryId').value = `AK${String(maxId + 1).padStart(3, '0')}`;
            document.getElementById('batteryModal').style.display = 'block';
        }

        function editBattery(index) {
            editingBatteryIndex = index;
            const battery = batteries[index];
            document.getElementById('batteryModalTitle').textContent = 'Akkumul√°tor Szerkeszt√©se';
            document.getElementById('batteryId').value = battery.id;
            document.getElementById('batteryTypeSelect').value = battery.type;
            document.getElementById('internalResistance').value = battery.internalResistance;
            document.getElementById('capacity').value = battery.capacity;
            document.getElementById('usageCount').value = battery.usageCount;
            document.getElementById('quality').value = battery.quality;
            document.getElementById('batteryLastCharge').value = battery.lastCharge;
            document.getElementById('batteryModal').style.display = 'block';
        }

        function saveBattery() {
            const battery = {
                id: document.getElementById('batteryId').value,
                type: document.getElementById('batteryTypeSelect').value,
                internalResistance: parseFloat(document.getElementById('internalResistance').value),
                capacity: parseInt(document.getElementById('capacity').value),
                usageCount: parseInt(document.getElementById('usageCount').value),
                quality: document.getElementById('quality').value,
                lastCharge: document.getElementById('batteryLastCharge').value
            };

            if (editingBatteryIndex === -1) {
                batteries.push(battery);
            } else {
                batteries[editingBatteryIndex] = battery;
            }

            closeBatteryModal();
            renderBatteryTable();
            saveAllCSVs();
        }

        function deleteBattery(index) {
            if (confirm('Biztosan t√∂r√∂lni szeretn√©d ezt az akkumul√°tort?')) {
                batteries.splice(index, 1);
                renderBatteryTable();
                saveAllCSVs();
            }
        }

        function closeBatteryModal() {
            document.getElementById('batteryModal').style.display = 'none';
        }

        function renderAssignmentTable() {
            const tbody = document.getElementById('assignmentTableBody');
            const searchTerm = document.getElementById('assignmentSearchInput').value.toLowerCase();
            
            let filteredAssignments = batteryAssignments;
            
            if (searchTerm) {
                filteredAssignments = filteredAssignments.filter(assignment => 
                    assignment.batteryId.toLowerCase().includes(searchTerm) ||
                    (assignment.deviceId && assignment.deviceId.toLowerCase().includes(searchTerm))
                );
            }

            tbody.innerHTML = '';
            filteredAssignments.forEach((assignment, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${assignment.assignmentId}</strong></td>
                    <td>${assignment.batteryId}</td>
                    <td>${assignment.deviceId || 'Tartal√©k'}</td>
                    <td>${assignment.assignmentDate}</td>
                    <td><span class="badge ${assignment.status === 'betarazva' ? 'badge-excellent' : 'badge-average'}">${assignment.status}</span></td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="editAssignment(${index})">‚úèÔ∏è</button>
                        <button class="btn" style="background: #dc3545; color: white; padding: 5px 10px; font-size: 12px;" onclick="deleteAssignment(${index})">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function addAssignment() {
            editingAssignmentIndex = -1;
            document.getElementById('assignmentModalTitle').textContent = '√öj √ñsszerendel√©s';
            document.getElementById('assignmentForm').reset();
            
            const maxId = batteryAssignments.length > 0 ? Math.max(...batteryAssignments.map(a => parseInt(a.assignmentId.replace('ASS', '')))) : 0;
            document.getElementById('assignmentId').value = `ASS${String(maxId + 1).padStart(3, '0')}`;
            
            const batterySelect = document.getElementById('assignmentBatteryId');
            batterySelect.innerHTML = '<option value="">V√°lassz akkumul√°tort...</option>';
            const availableBatteries = batteries.filter(b => !batteryAssignments.some(a => a.batteryId === b.id && a.status === 'betarazva'));
            availableBatteries.forEach(battery => {
                const option = document.createElement('option');
                option.value = battery.id;
                option.textContent = `${battery.id} (${battery.type}, ${battery.capacity}mAh, ${battery.quality})`;
                batterySelect.appendChild(option);
            });

            const deviceSelect = document.getElementById('assignmentDeviceId');
            deviceSelect.innerHTML = '<option value="">Tartal√©k (nincs eszk√∂z)</option>';
            devices.forEach(device => {
                const option = document.createElement('option');
                option.value = device.id;
                option.textContent = `${device.id} (${device.name})`;
                deviceSelect.appendChild(option);
            });

            document.getElementById('assignmentDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('assignmentModal').style.display = 'block';
        }

        function editAssignment(index) {
            editingAssignmentIndex = index;
            const assignment = batteryAssignments[index];
            document.getElementById('assignmentModalTitle').textContent = '√ñsszerendel√©s Szerkeszt√©se';
            
            document.getElementById('assignmentId').value = assignment.assignmentId;
            document.getElementById('assignmentBatteryId').value = assignment.batteryId;
            document.getElementById('assignmentDeviceId').value = assignment.deviceId || '';
            document.getElementById('assignmentDate').value = assignment.assignmentDate;
            document.getElementById('assignmentStatus').value = assignment.status;

            const batterySelect = document.getElementById('assignmentBatteryId');
            batterySelect.innerHTML = '<option value="">V√°lassz akkumul√°tort...</option>';
            const availableBatteries = batteries.filter(b => !batteryAssignments.some(a => a.batteryId === b.id && a.status === 'betarazva' && a.assignmentId !== assignment.assignmentId));
            availableBatteries.forEach(battery => {
                const option = document.createElement('option');
                option.value = battery.id;
                option.textContent = `${battery.id} (${battery.type}, ${battery.capacity}mAh, ${battery.quality})`;
                batterySelect.appendChild(option);
            });
            
            const deviceSelect = document.getElementById('assignmentDeviceId');
            deviceSelect.innerHTML = '<option value="">Tartal√©k (nincs eszk√∂z)</option>';
            devices.forEach(device => {
                const option = document.createElement('option');
                option.value = device.id;
                option.textContent = `${device.id} (${device.name})`;
                deviceSelect.appendChild(option);
            });

            document.getElementById('batteryAssignModal').style.display = 'block';
        }

        function saveAssignment() {
            const assignment = {
                assignmentId: document.getElementById('assignmentId').value,
                batteryId: document.getElementById('assignmentBatteryId').value,
                deviceId: document.getElementById('assignmentDeviceId').value || null,
                assignmentDate: document.getElementById('assignmentDate').value,
                status: document.getElementById('assignmentStatus').value
            };

            if (editingAssignmentIndex === -1) {
                batteryAssignments.push(assignment);
            } else {
                batteryAssignments[editingAssignmentIndex] = assignment;
            }

            closeAssignmentModal();
            renderAssignmentTable();
            saveAllCSVs();
        }

        function deleteAssignment(index) {
            if (confirm('Biztosan t√∂r√∂lni szeretn√©d ezt az √∂sszerendel√©st?')) {
                batteryAssignments.splice(index, 1);
                renderAssignmentTable();
                renderTable();
                saveAllCSVs();
            }
        }

        function closeAssignmentModal() {
            document.getElementById('assignmentModal').style.display = 'none';
        }

        function assignBattery(index) {
            const device = devices[index];
            if (device.batteryCount === 0 || !device.batteryType) {
                alert('Ez az eszk√∂z nem ig√©nyel akkumul√°tort az nyilv√°ntart√°sb√≥l!');
                return;
            }

            document.getElementById('batteryAssignModalTitle').textContent = `Akkumul√°tor Bet√°raz√°sa: ${device.name}`;
            document.getElementById('batteryAssignForm').reset();
            
            document.getElementById('assignDeviceId').value = device.id;
            document.getElementById('assignDate').value = new Date().toISOString().split('T')[0];
            
            const batterySelect = document.getElementById('assignBatteryId');
            batterySelect.innerHTML = '<option value="">V√°lassz akkumul√°tort...</option>';
            const availableBatteries = batteries.filter(b => 
                !batteryAssignments.some(a => a.batteryId === b.id && a.status === 'betarazva') && 
                b.type === device.batteryType
            );
            availableBatteries.forEach(battery => {
                const option = document.createElement('option');
                option.value = battery.id;
                option.textContent = `${battery.id} (${battery.type}, ${battery.capacity}mAh, ${battery.quality})`;
                batterySelect.appendChild(option);
            });

            const recommendedBattery = availableBatteries.reduce((best, current) => {
                if (!best) return current;
                const qualityOrder = { "Kiv√°l√≥": 5, "J√≥": 4, "K√∂zepes": 3, "Gyenge": 2, "Cser√©lend≈ë": 1 };
                if (qualityOrder[current.quality] > qualityOrder[best.quality]) return current;
                if (qualityOrder[current.quality] === qualityOrder[best.quality] && current.internalResistance < best.internalResistance) return current;
                return best;
            }, null);
            
            if (recommendedBattery) {
                document.getElementById('recommendedBattery').textContent = `Aj√°nlott: ${recommendedBattery.id} (${recommendedBattery.type}, ${recommendedBattery.capacity}mAh, ${recommendedBattery.quality})`;
            } else {
                document.getElementById('recommendedBattery').textContent = 'Nincs el√©rhet≈ë tartal√©k akkumul√°tor';
            }

            document.getElementById('batteryAssignModal').style.display = 'block';
        }

        function acceptRecommended() {
            const recommendedBattery = batteries.find(b => {
                const availableBatteries = batteries.filter(b => 
                    !batteryAssignments.some(a => a.batteryId === b.id && a.status === 'betarazva') && 
                    b.type === devices.find(d => d.id === document.getElementById('assignDeviceId').value).batteryType
                );
                return availableBatteries.reduce((best, current) => {
                    if (!best) return current;
                    const qualityOrder = { "Kiv√°l√≥": 5, "J√≥": 4, "K√∂zepes": 3, "Gyenge": 2, "Cser√©lend≈ë": 1 };
                    if (qualityOrder[current.quality] > qualityOrder[best.quality]) return current;
                    if (qualityOrder[current.quality] === qualityOrder[best.quality] && current.internalResistance < best.internalResistance) return current;
                    return best;
                }, null);
            });

            if (recommendedBattery) {
                document.getElementById('assignBatteryId').value = recommendedBattery.id;
                saveBatteryAssignment();
            } else {
                alert('Nincs aj√°nlott akkumul√°tor!');
            }
        }

        function saveBatteryAssignment() {
            const deviceId = document.getElementById('assignDeviceId').value;
            const batteryId = document.getElementById('assignBatteryId').value;
            const assignmentDate = document.getElementById('assignDate').value;
            
            if (!batteryId) {
                alert('K√©rlek, v√°lassz egy akkumul√°tort!');
                return;
            }

            batteryAssignments = batteryAssignments.filter(a => a.deviceId !== deviceId || a.status !== 'betarazva');
            
            const maxId = batteryAssignments.length > 0 ? Math.max(...batteryAssignments.map(a => parseInt(a.assignmentId.replace('ASS', '')))) : 0;
            const assignment = {
                assignmentId: `ASS${String(maxId + 1).padStart(3, '0')}`,
                batteryId: batteryId,
                deviceId: deviceId,
                assignmentDate: assignmentDate,
                status: 'betarazva'
            };
            batteryAssignments.push(assignment);

            batteryAssignments = batteryAssignments.map(a => {
                if (a.batteryId === batteryId && a.assignmentId !== assignment.assignmentId) {
                    return { ...a, status: 'tartalek', deviceId: null };
                }
                return a;
            });

            closeBatteryAssignModal();
            renderTable();
            renderAssignmentTable();
            saveAllCSVs();
        }

        function closeBatteryAssignModal() {
            document.getElementById('batteryAssignModal').style.display = 'none';
        }

        function saveAllCSVs() {
            if (devices.length > 0) {
                const headers = ['ID', 'Nev', 'Hely', 'Tipus', 'Darab', 'Tolto', 'Gyakorisag', 'Utolso_toltes', 'Megjegyzes'];
                let csvContent = headers.join(',') + '\n';
                devices.forEach(device => {
                    const row = [
                        device.id || '',
                        device.name || '',
                        device.location || '',
                        device.batteryType || '',
                        device.batteryCount || 0,
                        device.chargerType || '',
                        device.usageFrequency || '',
                        device.lastCharge || '',
                        device.notes || ''
                    ];
                    csvContent += row.join(',') + '\n';
                });
                const devicesBlob = new Blob([csvContent], { type: 'text/plain;charset=utf-8' });
                const devicesLink = document.createElement('a');
                devicesLink.href = URL.createObjectURL(devicesBlob);
                devicesLink.download = `eszkozok_${new Date().toISOString().split('T')[0]}.csv`;
                devicesLink.click();
            }

            if (batteries.length > 0) {
                const headers = ['AkkuID', 'Tipus', 'Belso_ellenallas_mO', 'Kapacitas_mAh', 'Felhasznalasi_szam', 'Minosites', 'Utolso_toltes'];
                let csvContent = headers.join(',') + '\n';
                batteries.forEach(battery => {
                    const row = [
                        battery.id || '',
                        battery.type || '',
                        battery.internalResistance || 0,
                        battery.capacity || 0,
                        battery.usageCount || 0,
                        battery.quality || '',
                        battery.lastCharge || ''
                    ];
                    csvContent += row.join(',') + '\n';
                });
                const batteriesBlob = new Blob([csvContent], { type: 'text/plain;charset=utf-8' });
                const batteriesLink = document.createElement('a');
                batteriesLink.href = URL.createObjectURL(batteriesBlob);
                batteriesLink.download = `akkumulator_v2_${new Date().toISOString().split('T')[0]}.csv`;
                batteriesLink.click();
            }

            if (batteryAssignments.length > 0) {
                const headers = ['OsszerendelesID', 'AkkuID', 'EszkozID', 'Datum', 'Allapot'];
                let csvContent = headers.join(',') + '\n';
                batteryAssignments.forEach(assignment => {
                    const row = [
                        assignment.assignmentId || '',
                        assignment.batteryId || '',
                        assignment.deviceId || '',
                        assignment.assignmentDate || '',
                        assignment.status || ''
                    ];
                    csvContent += row.join(',') + '\n';
                });
                const assignmentsBlob = new Blob([csvContent], { type: 'text/plain;charset=utf-8' });
                const assignmentsLink = document.createElement('a');
                assignmentsLink.href = URL.createObjectURL(assignmentsBlob);
                assignmentsLink.download = `vandorlas_${new Date().toISOString().split('T')[0]}.csv`;
                assignmentsLink.click();
            }

            alert('‚úÖ √ñsszes CSV f√°jl elmentve!');
        }

        function exportCSV() {
            if (devices.length === 0) {
                alert('Nincsenek eszk√∂z√∂k!');
                return;
            }
            const headers = ['ID', 'Nev', 'Hely', 'Tipus', 'Darab', 'Tolto', 'Gyakorisag', 'Utolso_toltes', 'Megjegyzes'];
            let csvContent = headers.join(',') + '\n';
            devices.forEach(device => {
                const row = [
                    device.id || '',
                    device.name || '',
                    device.location || '',
                    device.batteryType || '',
                    device.batteryCount || 0,
                    device.chargerType || '',
                    device.usageFrequency || '',
                    device.lastCharge || '',
                    device.notes || ''
                ];
                csvContent += row.join(',') + '\n';
            });
            const blob = new Blob([csvContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `eszkozok_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            alert('‚úÖ Eszk√∂z CSV export√°lva!');
        }

        function loadCSV() {
            const fileInput = document.getElementById('csvInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('K√©rlek, v√°lassz ki egy CSV f√°jlt!');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const text = new TextDecoder("utf-8").decode(data);
                    const rows = text.trim().split("\n").map(row => row.split(","));
                    parseCSVRows(rows);
                } catch (error) {
                    alert('Hiba t√∂rt√©nt a CSV f√°jl beolvas√°sakor: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function parseCSVRows(rows) {
            if (!rows.length || !rows[0].length) {
                alert("A CSV f√°jl √©rv√©nytelen vagy √ºres.");
                return;
            }
            const newDevices = [];
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (row.length === 0 || (row.length === 1 && row[0] === '')) continue;
                const device = {
                    id: row[0] || `ESZ${String(i).padStart(3, '0')}`,
                    name: row[1] || '',
                    location: row[2] || '',
                    batteryType: row[3] || '',
                    batteryCount: parseInt(row[4]) || 0,
                    chargerType: row[5] || '',
                    usageFrequency: row[6] || null,
                    lastCharge: row[7] || null,
                    notes: row[8] || ''
                };
                newDevices.push(device);
            }
            if (newDevices.length === 0) {
                alert('Nem siker√ºlt egyetlen eszk√∂zt sem beolvasni!');
                return;
            }
            if (devices.length > 0) {
                if (!confirm(`${newDevices.length} eszk√∂z lesz bet√∂ltve. Ez fel√ºl√≠rja a jelenlegi ${devices.length} eszk√∂zt. Folytatod?`)) {
                    return;
                }
            }
            devices = newDevices;
            renderTable();
            document.getElementById('csvInput').value = '';
            alert(`‚úÖ ${newDevices.length} eszk√∂z sikeresen bet√∂ltve!`);
            saveAllCSVs();
        }

        function exportBatteryCSV() {
            if (batteries.length === 0) {
                alert('Nincsenek akkumul√°torok!');
                return;
            }
            const headers = ['AkkuID', 'Tipus', 'Belso_ellenallas_mO', 'Kapacitas_mAh', 'Felhasznalasi_szam', 'Minosites', 'Utolso_toltes'];
            let csvContent = headers.join(',') + '\n';
            batteries.forEach(battery => {
                const row = [
                    battery.id || '',
                    battery.type || '',
                    battery.internalResistance || 0,
                    battery.capacity || 0,
                    battery.usageCount || 0,
                    battery.quality || '',
                    battery.lastCharge || ''
                ];
                csvContent += row.join(',') + '\n';
            });
            const blob = new Blob([csvContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `akkumulator_v2_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            alert('‚úÖ Akku CSV export√°lva!');
        }

        function loadBatteryCSV() {
            const fileInput = document.getElementById('batteryCSVInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('K√©rlek, v√°lassz ki egy CSV f√°jlt!');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const text = new TextDecoder("utf-8").decode(data);
                    const rows = text.trim().split("\n").map(row => row.split(","));
                    parseBatteryCSVRows(rows);
                } catch (error) {
                    alert('Hiba t√∂rt√©nt az akku CSV f√°jl beolvas√°sakor: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function parseBatteryCSVRows(rows) {
            if (!rows.length || !rows[0].length) {
                alert("A CSV f√°jl √©rv√©nytelen vagy √ºres.");
                return;
            }
            const newBatteries = [];
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (row.length === 0 || (row.length === 1 && row[0] === '')) continue;
                const battery = {
                    id: row[0] || `AK${String(i).padStart(3, '0')}`,
                    type: row[1] || '',
                    internalResistance: parseFloat(row[2]) || 0,
                    capacity: parseInt(row[3]) || 0,
                    usageCount: parseInt(row[4]) || 0,
                    quality: row[5] || '',
                    lastCharge: row[6] || null
                };
                newBatteries.push(battery);
            }
            if (newBatteries.length === 0) {
                alert('Nem siker√ºlt egyetlen akkumul√°tort sem beolvasni!');
                return;
            }
            if (batteries.length > 0) {
                if (!confirm(`${newBatteries.length} akkumul√°tor lesz bet√∂ltve. Ez fel√ºl√≠rja a jelenlegi ${batteries.length} akkumul√°tort. Folytatod?`)) {
                    return;
                }
            }
            batteries = newBatteries;
            renderBatteryTable();
            document.getElementById('batteryCSVInput').value = '';
            alert(`‚úÖ ${newBatteries.length} akkumul√°tor sikeresen bet√∂ltve!`);
            saveAllCSVs();
        }

        function exportAssignmentCSV() {
            if (batteryAssignments.length === 0) {
                alert('Nincsenek √∂sszerendel√©sek!');
                return;
            }
            const headers = ['OsszerendelesID', 'AkkuID', 'EszkozID', 'Datum', 'Allapot'];
            let csvContent = headers.join(',') + '\n';
            batteryAssignments.forEach(assignment => {
                const row = [
                    assignment.assignmentId || '',
                    assignment.batteryId || '',
                    assignment.deviceId || '',
                    assignment.assignmentDate || '',
                    assignment.status || ''
                ];
                csvContent += row.join(',') + '\n';
            });
            const blob = new Blob([csvContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `vandorlas_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            alert('‚úÖ V√°ndorl√°s CSV export√°lva!');
        }

        function loadAssignmentCSV() {
            const fileInput = document.getElementById('assignmentCSVInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('K√©rlek, v√°lassz ki egy CSV f√°jlt!');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const text = new TextDecoder("utf-8").decode(data);
                    const rows = text.trim().split("\n").map(row => row.split(","));
                    parseAssignmentCSVRows(rows);
                } catch (error) {
                    alert('Hiba t√∂rt√©nt a v√°ndorl√°s CSV f√°jl beolvas√°sakor: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function parseAssignmentCSVRows(rows) {
            if (!rows.length || !rows[0].length) {
                alert("A v√°ndorl√°s CSV f√°jl √©rv√©nytelen vagy √ºres.");
                return;
            }
            const newAssignments = [];
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (row.length === 0 || (row.length === 1 && row[0] === '')) continue;
                const assignment = {
                    assignmentId: row[0] || `ASS${String(i).padStart(3, '0')}`,
                    batteryId: row[1] || '',
                    deviceId: row[2] || null,
                    assignmentDate: row[3] || new Date().toISOString().split('T')[0],
                    status: row[4] || 'tartalek'
                };
                newAssignments.push(assignment);
            }
            if (newAssignments.length === 0) {
                alert('Nem siker√ºlt egyetlen √∂sszerendel√©st sem beolvasni!');
                return;
            }
            if (batteryAssignments.length > 0) {
                if (!confirm(`${newAssignments.length} √∂sszerendel√©s lesz bet√∂ltve. Ez fel√ºl√≠rja a jelenlegi ${batteryAssignments.length} √∂sszerendel√©st. Folytatod?`)) {
                    return;
                }
            }
            batteryAssignments = newAssignments;
            renderAssignmentTable();
            document.getElementById('assignmentCSVInput').value = '';
            alert(`‚úÖ ${newAssignments.length} √∂sszerendel√©s sikeresen bet√∂ltve!`);
            saveAllCSVs();
        }

        function deleteSampleData() {
            if (confirm('Biztosan t√∂r√∂lni szeretn√©d az √∂sszes mintaadatot?')) {
                devices = devices.filter(device => !device.id.startsWith('ESZ'));
                batteries = batteries.filter(battery => !battery.id.startsWith('AK'));
                batteryAssignments = batteryAssignments.filter(assignment => !assignment.assignmentId.startsWith('ASS'));
                renderTable();
                renderBatteryTable();
                renderAssignmentTable();
                saveAllCSVs();
                alert('‚úÖ Mintaadatok t√∂r√∂lve!');
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Content').classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'devices') {
                renderTable();
            } else if (tabName === 'batteries') {
                renderBatteryTable();
            } else if (tabName === 'assignments') {
                renderAssignmentTable();
            }
        }

        window.onclick = function(event) {
            const deviceModal = document.getElementById('deviceModal');
            const batteryModal = document.getElementById('batteryModal');
            const assignmentModal = document.getElementById('assignmentModal');
            const batteryAssignModal = document.getElementById('batteryAssignModal');
            if (event.target === deviceModal) {
                closeModal();
            }
            if (event.target === batteryModal) {
                closeBatteryModal();
            }
            if (event.target === assignmentModal) {
                closeAssignmentModal();
            }
            if (event.target === batteryAssignModal) {
                closeBatteryAssignModal();
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Devices loaded:', devices);
            console.log('Batteries loaded:', batteries);
            console.log('Assignments loaded:', batteryAssignments);
            renderTable();
            renderBatteryTable();
            renderAssignmentTable();
            
            document.getElementById('searchInput').addEventListener('input', renderTable);
            document.getElementById('batterySearchInput').addEventListener('input', renderBatteryTable);
            document.getElementById('assignmentSearchInput').addEventListener('input', renderAssignmentTable);
            
            document.getElementById('deviceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveDevice();
            });
            
            document.getElementById('batteryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBattery();
            });
            
            document.getElementById('assignmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveAssignment();
            });
            
            document.getElementById('batteryAssignForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBatteryAssignment();
            });
        });
    </script>
</body>
</html>
